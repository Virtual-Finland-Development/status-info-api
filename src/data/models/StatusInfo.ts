import { DynamoDBModel } from "../../services/AWS/DynamoDB/DynamoDBORMTypes";

// Luonnos, Lähetetty, Käsittelyssä, Odottaa täydentämistä, Valmis,
export enum KnownStatusValues {
  "SENT" = "Sent",
  "PROCESSING" = "Processing",
  "WAITING_FOR_COMPLETION" = "Waiting for completion",
  "READY" = "Ready",
}

// @see: https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.NamingRulesDataTypes.html
const StatusInfo: DynamoDBModel = {
  tableName: "StatusInfo",
  schema: {
    KeySchema: [
      {
        AttributeName: "id",
        KeyType: "HASH",
      },
    ],
    AttributeDefinitions: [
      {
        AttributeName: "id", // auto-generated hash
        AttributeType: "S",
        _AutoGenerated: {
          onEvents: ["create"],
          autoGenType: "uuidv5",
          autoGenFields: ["userId", "statusName"],
        },
      },
      {
        AttributeName: "userId",
        AttributeType: "S",
      },
      {
        AttributeName: "userEmail",
        AttributeType: "S",
      },
      {
        AttributeName: "statusName",
        AttributeType: "S",
      },
      {
        AttributeName: "statusValue",
        AttributeType: "S",
        _AllowedValues: Object.keys(KnownStatusValues),
        _DefaultValue: "SENT",
      },
      {
        AttributeName: "updatedAt", // auto-generated timestamp
        AttributeType: "S",
        _AutoGenerated: {
          onEvents: ["create", "update"],
          autoGenType: "timestamp",
          format: "iso",
        },
      },
    ],
  },
  openapi: {
    schema: {
      type: "object",
      properties: {
        id: {
          description: "auto-generated",
          type: "string",
        },
        statusName: {
          description: "name of the status",
          type: "string",
        },
        statusValue: {
          description: "value of the status",
          type: "string",
          enum: Object.keys(KnownStatusValues),
          default: "SENT",
        },
        userId: {
          description: "user identification code",
          type: "string",
        },
        userEmail: {
          description: "email of the user",
          type: "string",
        },
        updatedAt: {
          description: "auto-generated timestamp",
          type: "string",
          format: "date-time",
        },
      },
    },
  },
};

export default StatusInfo;
